<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T3U3">Fn</span>,<span class="var type1" id="S3T3U4">Fpd</span>,<span class="var type1" id="S4T3U5">Fff</span>,<span class="var type1" id="S5T3U6">eq</span>,<span class="var type1" id="S6T3U7">edq</span>] = Ffcn(<span class="var type1" id="S7T1U10">varF</span>,<span class="var type1" id="S8T3U11">A</span>,<span class="var type1" id="S9T2U12">mode</span>,<span class="var type1" id="S10T3U13">q</span>,<span class="var type1" id="S11T3U14">dq</span>,<span class="var type1" id="S12T4U15">qc</span>,<span class="var type1" id="S13T3U16">dqc</span>,<span class="var type1" id="S14T3U17">ddqc</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S15T2U20">kq</span> = <span class="mxinfo" id="T2:U16"><span class="var type1" id="S7T1U22">varF</span>(<span class="mxinfo" id="T2:U18">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo" id="T2:U19"><span class="var type1" id="S16T2U26">komega</span> = <span class="mxinfo" id="T2:U21"><span class="var type1" id="S7T1U28">varF</span>(<span class="mxinfo" id="T2:U23">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T2:U24"><span class="var type1" id="S17T2U32">mQ</span> = <span class="mxinfo" id="T2:U26"><span class="var type1" id="S7T1U34">varF</span>(<span class="mxinfo" id="T2:U28">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T2:U29"><span class="var type1" id="S18T2U38">L</span> = <span class="mxinfo" id="T2:U31"><span class="var type1" id="S7T1U40">varF</span>(<span class="mxinfo" id="T2:U33">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T6:U34"><span class="var type1" id="S9T2U45">mode</span> == <span class="mxinfo" id="T2:U36">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo" id="T3:U37"><span class="var type1" id="S2T3U49">Fn</span> = <span class="mxinfo" id="T3:U39"><span class="mxinfo" id="T2:U40">dot(<span class="var type1" id="S8T3U53">A</span>,<span class="var type1" id="S10T3U54">q</span>)</span>*<span class="var type1" id="S10T3U55">q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo" id="T3:U44"><span class="var type1" id="S2T3U59">Fn</span> = <span class="mxinfo" id="T3:U46"><span class="mxinfo" id="T2:U47">-<span class="mxinfo" id="T2:U48">dot(<span class="var type1" id="S12T4U64">qc</span>,<span class="var type1" id="S10T3U65">q</span>)</span></span>*<span class="var type1" id="S10T3U66">q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">% switch mode</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">%     case 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">%         Fn = dot(A,q)*q;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">%     otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="comment">%         Fn = -dot(qc,q)*q;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T5:U52"><span class="var type1" id="S20T5U69">qhat</span> = <span class="mxinfo" id="T5:U54">[ <span class="mxinfo" id="T7:U55"><span class="mxinfo" id="T2:U56">0</span>    <span class="mxinfo" id="T2:U57">-<span class="mxinfo" id="T2:U58"><span class="var type1" id="S10T3U75">q</span>(<span class="mxinfo" id="T2:U60">3</span>)</span></span> <span class="mxinfo" id="T2:U61"><span class="var type1" id="S10T3U78">q</span>(<span class="mxinfo" id="T2:U63">2</span>)</span></span>;</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo" id="T5:U52"><span class="mxinfo" id="T5:U54">         <span class="mxinfo" id="T7:U64"><span class="mxinfo" id="T2:U65"><span class="var type1" id="S10T3U82">q</span>(<span class="mxinfo" id="T2:U67">3</span>)</span>  <span class="mxinfo" id="T2:U68">0</span>   <span class="mxinfo" id="T2:U69">-<span class="mxinfo" id="T2:U70"><span class="var type1" id="S10T3U87">q</span>(<span class="mxinfo" id="T2:U72">1</span>)</span></span></span>;</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T5:U52"><span class="mxinfo" id="T5:U54">        <span class="mxinfo" id="T7:U73"><span class="mxinfo" id="T2:U74">-<span class="mxinfo" id="T2:U75"><span class="var type1" id="S10T3U92">q</span>(<span class="mxinfo" id="T2:U77">2</span>)</span></span>  <span class="mxinfo" id="T2:U78"><span class="var type1" id="S10T3U95">q</span>(<span class="mxinfo" id="T2:U80">1</span>)</span> <span class="mxinfo" id="T2:U81">0</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T3:U82"><span class="var type1" id="S5T3U100">eq</span> = <span class="mxinfo" id="T3:U84"><span class="mxinfo" id="T5:U85"><span class="var type1" id="S20T5U103">qhat</span>^2</span>*<span class="var type1" id="S12T4U105">qc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T3:U88"><span class="var type1" id="S6T3U108">edq</span> = <span class="mxinfo" id="T3:U90"><span class="var type1" id="S11T3U110">dq</span> - <span class="mxinfo" id="T3:U92">cross((<span class="mxinfo" id="T3:U93">cross(<span class="var type1" id="S12T4U116">qc</span>,<span class="var type1" id="S13T3U117">dqc</span>)</span>),<span class="var type1" id="S10T3U118">q</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo" id="T3:U97"><span class="var type1" id="S3T3U121">Fpd</span> = <span class="mxinfo" id="T3:U99"><span class="mxinfo" id="T3:U100"><span class="mxinfo" id="T2:U101">-<span class="var type1" id="S15T2U125">kq</span></span>*<span class="var type1" id="S5T3U126">eq</span></span> - <span class="mxinfo" id="T3:U104"><span class="var type1" id="S16T2U128">komega</span>*<span class="var type1" id="S6T3U129">edq</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T2:U107"><span class="var type1" id="S22T2U132">inprod</span> = <span class="mxinfo" id="T2:U109">dot(<span class="var type1" id="S10T3U135">q</span>,(<span class="mxinfo" id="T3:U111">cross(<span class="var type1" id="S12T4U139">qc</span>,<span class="var type1" id="S13T3U140">dqc</span>)</span>))</span></span>;<span class="comment">% strange inproduct</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo" id="T3:U114"><span class="var type1" id="S4T3U143">Fff</span> = <span class="mxinfo" id="T3:U116"><span class="mxinfo" id="T3:U117"><span class="mxinfo" id="T2:U118"><span class="mxinfo" id="T2:U119"><span class="var type1" id="S17T2U148">mQ</span>*<span class="var type1" id="S18T2U149">L</span></span>*<span class="var type1" id="S22T2U150">inprod</span></span>*<span class="mxinfo" id="T3:U123">cross(<span class="var type1" id="S10T3U153">q</span>,<span class="var type1" id="S11T3U154">dq</span>)</span></span> + <span class="mxinfo" id="T3:U126"><span class="mxinfo" id="T2:U127"><span class="var type1" id="S17T2U157">mQ</span>*<span class="var type1" id="S18T2U158">L</span></span>*<span class="mxinfo" id="T3:U130">cross((<span class="mxinfo" id="T3:U131">cross(<span class="var type1" id="S12T4U164">qc</span>,<span class="var type1" id="S14T3U165">ddqc</span>)</span>),<span class="var type1" id="S10T3U166">q</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="comment">% Fff = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="comment">% Fff = mQ*inprod*cross(q,dq) + mQ*cross((cross(qc,ddqc)),q);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
</pre>
